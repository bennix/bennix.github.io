---
layout: post
title: Chainer ä»‹ç»
date: 2017-12-14
categories: blog
tags: [Chainer,ä»‹ç»]
description: Chainer ä»‹ç»
---


# Chainer ä»‹ç»

è¿™é‡Œæ˜¯ Chainer æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ åœ¨æ­¤éƒ¨åˆ†ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä¸‹å†…å®¹:

* ç°è¡Œæ¡†æ¶çš„ä¼˜ç¼ºç‚¹ä»¥åŠæˆ‘ä»¬ä¸ºä»€ä¹ˆå¼€å‘ Chainer
* å‰å‘ä»¥åŠåå‘è®¡ç®—çš„ç®€å•çš„ä¾‹å­
* è¿æ¥çš„ä½¿ç”¨ä»¥åŠæ¢¯åº¦è®¡ç®—
* chains çš„æ„å»º(å³. å¤§å¤šæ•°æ¡†æ¶æ‰€æŒ‡çš„â€œæ¨¡å‹â€)
* å‚æ•°ä¼˜åŒ–
* è¿æ¥å’Œä¼˜åŒ–å™¨çš„ä¸²è¡ŒåŒ–

è¯»å®Œæ­¤éƒ¨åˆ†ï¼Œæ‚¨å°†èƒ½å¤Ÿ:

* è®¡ç®—ä¸€äº›ç®—å¼çš„æ¢¯åº¦
* ç”¨ Chainer å†™ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥å™¨


## æ ¸å¿ƒæ¦‚å¿µ

æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œ Chainer æ˜¯ä¸€ä¸ªæŸ”æ€§çš„ç¥ç»ç½‘ç»œæ¡†æ¶ã€‚æˆ‘ä»¬çš„ä¸»è¦ç›®æ ‡å°±æ˜¯æŸ”æ€§ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç®€å•ç›´è§‚çš„å†™å‡ºå¤æ‚çš„ç½‘ç»œã€‚

å½“ä¸‹å·²æœ‰çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ä½¿ç”¨çš„æ˜¯â€œå®šä¹‰åè¿è¡Œâ€æœºåˆ¶ã€‚å³æ„å‘³ç€ï¼Œé¦–å…ˆå®šä¹‰å¹¶ä¸”å›ºåŒ–ä¸€ä¸ªç½‘ç»œï¼Œå†å‘¨è€Œå¤å§‹åœ°é¦ˆå…¥å°æ‰¹é‡æ•°æ®è¿›è¡Œè®­ç»ƒã€‚ç”±äºç½‘ç»œæ˜¯åœ¨ä»»ä½•å‰å‘ã€åå‘è®¡ç®—å‰é™æ€å®šä¹‰çš„ï¼Œæ‰€æœ‰çš„é€»è¾‘ä½œä¸º**æ•°æ®**å¿…é¡»äº‹å…ˆåµŒå…¥ç½‘ç»œä¸­ã€‚ æ„å‘³ç€ï¼Œåœ¨è¯¸å¦‚Caffeè¿™æ ·çš„æ¡†æ¶ä¸­é€šè¿‡å£°æ˜çš„æ–¹æ³•å®šä¹‰ç½‘ç»œç»“æ„ã€‚ï¼ˆæ³¨ï¼šå¯ä»¥ä½¿ç”¨torch.nn, åŸºäº Theanoæ¡†æ¶, ä»¥åŠ TensorFlow çš„å‘½ä»¤è¯­å¥å®šä¹‰ä¸€ä¸ªé™æ€ç½‘ç»œï¼‰

## è¾¹å®šä¹‰è¾¹è¿è¡Œ

 Chainer å¯¹åº”åœ°é‡‡ç”¨äº†ä¸€ç§å«åš â€œè¾¹å®šä¹‰è¾¹è¿è¡Œâ€ çš„æœºåˆ¶, å³, ç½‘ç»œå¯ä»¥åœ¨å®é™…è¿›è¡Œå‰å‘è®¡ç®—çš„æ—¶å€™åŒæ—¶è¢«å®šä¹‰ã€‚ æ›´åŠ å‡†ç¡®çš„è¯´, Chainer å­˜å‚¨çš„æ˜¯è®¡ç®—çš„å†å²ç»“æœè€Œä¸æ˜¯è®¡ç®—é€»è¾‘ã€‚è¿™ä¸ªç­–ç•¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿå……åˆ†åˆ©ç”¨Pythonä¸­ç¼–ç¨‹é€»è¾‘çš„åŠ›é‡ã€‚ä¾‹å¦‚ï¼ŒChainerä¸éœ€è¦ä»»ä½•é­”æ³•å°±å¯ä»¥å°†æ¡ä»¶å’Œå¾ªç¯å¼•å…¥åˆ°ç½‘ç»œå®šä¹‰ä¸­ã€‚ è¾¹å®šä¹‰è¾¹è¿è¡Œæ˜¯Chainerçš„æ ¸å¿ƒæ¦‚å¿µã€‚ æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­å±•ç¤ºå¦‚ä½•åŠ¨æ€å®šä¹‰ç½‘ç»œã€‚

è¿™ä¸ªç­–ç•¥ä¹Ÿä½¿ç¼–å†™å¤šGPUå¹¶è¡ŒåŒ–å˜å¾—å®¹æ˜“ï¼Œå› ä¸ºé€»è¾‘æ›´æ¥è¿‘äºç½‘ç»œæ“ä½œã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹åé¢çš„ç« èŠ‚ä¸­å›é¡¾è¿™äº›è®¾æ–½ã€‚

Chainer å°†ç½‘ç»œè¡¨ç¤ºä¸º**è®¡ç®—å›¾**ä¸Šçš„æ‰§è¡Œè·¯å¾„ã€‚è®¡ç®—å›¾æ˜¯ä¸€ç³»åˆ—å‡½æ•°åº”ç”¨ï¼Œå› æ­¤å®ƒå¯ä»¥ç”¨å¤šä¸ª`Function`å¯¹è±¡æ¥æè¿°ã€‚å½“è¿™ä¸ª`Function`æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œå±‚æ—¶ï¼ŒåŠŸèƒ½çš„å‚æ•°å°†é€šè¿‡è®­ç»ƒæ¥æ›´æ–°ã€‚å› æ­¤ï¼Œè¯¥å‡½æ•°éœ€è¦åœ¨å†…éƒ¨ä¿ç•™å¯è®­ç»ƒçš„å‚æ•°ï¼Œå› æ­¤Chainerå…·æœ‰Linkç±»ï¼Œå®ƒå¯ä»¥åœ¨ç±»çš„å¯¹è±¡ä¸Šä¿å­˜å¯è®­ç»ƒå‚æ•°ã€‚åœ¨`Link`å¯¹è±¡ä¸­æ‰§è¡Œçš„å‡½æ•°çš„å‚æ•°è¢«è¡¨ç¤ºä¸º`Variable`å¯¹è±¡ã€‚ ç®€è¨€ä¹‹ï¼Œ`Link`å’Œ`Function`ä¹‹é—´çš„åŒºåˆ«åœ¨äºå®ƒæ˜¯å¦åŒ…å«å¯è®­ç»ƒå‚æ•°ã€‚ ç¥ç»ç½‘ç»œæ¨¡å‹é€šå¸¸è¢«æè¿°ä¸ºä¸€ç³»åˆ—`Link`å’Œ`Function`ã€‚

æ‚¨å¯ä»¥é€šè¿‡åŠ¨æ€â€œé“¾æ¥â€å„ç§`Link`å’Œ`Function`æ¥æ„å»ºè®¡ç®—å›¾æ¥å®šä¹‰Chainã€‚åœ¨æ¡†æ¶ä¸­ï¼Œé€šè¿‡è¿è¡Œé“¾æ¥å›¾æ¥å®šä¹‰ç½‘ç»œï¼Œå› æ­¤åç§°æ˜¯Chainerã€‚

> åœ¨æœ¬æ•™ç¨‹çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å‡å®šä¸ºäº†ç®€å•èµ·è§ï¼Œå·²ç»é¢„å…ˆå¯¼å…¥äº†ä»¥ä¸‹è¯­å¥ï¼š


```python
import numpy as np
import chainer
from chainer import cuda, Function, gradient_check, report, training, utils, Variable
from chainer import datasets, iterators, optimizers, serializers
from chainer import Link, Chain, ChainList
import chainer.functions as F
import chainer.links as L
from chainer.training import extensions
```

è¿™äº›å¯¼å…¥å¹¿æ³›å‡ºç°åœ¨Chainerä»£ç å’Œä¾‹å­ä¸­ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­çœç•¥äº†è¿™äº›å¯¼å…¥ã€‚

## å‰å‘/åå‘è®¡ç®—

å¦‚ä¸Šæ‰€è¿°ï¼ŒChainerä½¿ç”¨â€œè¾¹å®šä¹‰è¾¹è¿è¡Œâ€æ–¹æ¡ˆï¼Œå› æ­¤å‰å‘è®¡ç®—æœ¬èº«å³å®šä¹‰äº†ç½‘ç»œã€‚ä¸ºäº†å¼€å§‹å‰å‘è®¡ç®—ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¾“å…¥æ•°ç»„è®¾ç½®ä¸ºä¸€ä¸ª`Variable`å¯¹è±¡ã€‚è¿™é‡Œæˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ndarrayå¼€å§‹ï¼Œåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼š



```python
x_data = np.array([5], dtype=np.float32)
```


```python
x = Variable(x_data)
```

`Variable` å¯¹è±¡å…·æœ‰åŸºæœ¬çš„ç®—æœ¯è¿ç®—ç¬¦ã€‚ä¸ºäº†è®¡ç®— $y = x^2 - 2x + 1$, åªéœ€å†™ï¼š


```python
y = x**2 - 2 * x + 1
```

ç»“æœyä¹Ÿæ˜¯ä¸€ä¸ª`Variable`å¯¹è±¡ï¼Œå…¶å€¼å¯ä»¥é€šè¿‡è®¿é—®`data`å±æ€§æ¥æå–ï¼š


```python
y.data
```




    array([ 16.], dtype=float32)



yæ‰€æŒæœ‰çš„ä¸ä»…æ˜¯ç»“æœçš„æ•°å€¼ã€‚å®ƒä¹Ÿä¿æŒè®¡ç®—çš„å†å²ï¼ˆå³è®¡ç®—å›¾ï¼‰ï¼Œå…¶èƒ½å¤Ÿè®¡ç®—å…¶å·®åˆ†ã€‚è¿™æ˜¯é€šè¿‡è°ƒç”¨å®ƒçš„`backward()`æ–¹æ³•å®Œæˆçš„ï¼š



```python
y.backward()
```

å…¶è¿è¡Œé”™è¯¯åå‘ä¼ æ’­ï¼ˆä¹Ÿç§°ä¸ºåå‘ä¼ æ’­æˆ–åå‘æ¨¡å¼è‡ªåŠ¨å·®åˆ†ï¼‰ã€‚ç„¶åï¼Œè®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨è¾“å…¥å˜é‡xçš„`grad`å±æ€§ä¸­ï¼š


```python
x.grad
```




    array([ 8.], dtype=float32)



æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¡ç®—ä¸­é—´å˜é‡çš„æ¢¯åº¦ã€‚è¯·æ³¨æ„ï¼ŒChaineré»˜è®¤æƒ…å†µä¸‹ä¼šé‡Šæ”¾ä¸­é—´å˜é‡çš„æ¢¯åº¦æ•°ç»„ä»¥æé«˜å†…å­˜æ•ˆç‡ã€‚ä¸ºäº†ä¿ç•™æ¢¯åº¦ä¿¡æ¯ï¼Œè¯·å°†`retain_grad`å‚æ•°ä¼ é€’ç»™`backward`æ–¹æ³•ï¼š


```python
z = 2*x
y = x**2 - z + 1
y.backward(retain_grad=True)
z.grad
```




    array([-1.], dtype=float32)



å¦åˆ™ï¼Œ`z.grad`å°†ä¸º`None`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š


```python
z = 2*x
y = x**2 - z + 1
y.backward()
z.grad
```


```python
z.grad is None
```




    True



æ‰€æœ‰è¿™äº›è®¡ç®—éƒ½å¾ˆå®¹æ˜“æ¨å¹¿åˆ°å¤šå…ƒç´ æ•°ç»„è¾“å…¥ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä»ä¸€ä¸ªåŒ…å«å¤šå…ƒç´ æ•°ç»„çš„å˜é‡å¼€å§‹å‘åè®¡ç®—ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨è®¾ç½®åˆå§‹é”™è¯¯ã€‚ å› ä¸ºå½“ä¸€ä¸ªå˜é‡çš„`size`ï¼ˆè¿™æ„å‘³ç€æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰æ˜¯1æ—¶ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè¡¨ç¤ºæŸå¤±å€¼çš„å˜é‡å¯¹è±¡ï¼Œæ‰€ä»¥å˜é‡çš„`grad`å±æ€§è¢«è‡ªåŠ¨å¡«å……ä¸º1ã€‚ å¦ä¸€æ–¹é¢ï¼Œå½“ä¸€ä¸ªå˜é‡çš„å¤§å°å¤§äº1æ—¶ï¼Œ`grad`å±æ€§ä¿æŒä¸º`None`ï¼Œå¹¶ä¸”åœ¨è¿è¡Œ`backwardï¼ˆï¼‰`ä¹‹å‰éœ€è¦æ˜ç¡®åœ°è®¾ç½®åˆå§‹é”™è¯¯ã€‚è¿™å¯ä»¥ç®€å•åœ°é€šè¿‡è®¾ç½®è¾“å‡ºå˜é‡çš„`grad`å±æ€§æ¥å®Œæˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š


```python
x = Variable(np.array([[1, 2, 3], [4, 5, 6]], dtype=np.float32))
y = x**2 - 2*x + 1
y.grad = np.ones((2, 3), dtype=np.float32)
y.backward()
x.grad
```




    array([[  0.,   2.,   4.],
           [  6.,   8.,  10.]], dtype=float32)



> åœ¨`functions`æ¨¡å—ä¸­å®šä¹‰äº†è®¸å¤šé‡‡ç”¨`Variable`å¯¹è±¡çš„å‡½æ•°ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬ç»“åˆèµ·æ¥ï¼Œå®ç°å…·æœ‰è‡ªåŠ¨åå‘è®¡ç®—çš„å¤æ‚åŠŸèƒ½.

## è¿æ¥


ä¸ºäº†ç¼–å†™ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å¿…é¡»å°†å‡½æ•°ä¸å‚æ•°ç›¸ç»“åˆï¼Œå¹¶ä¼˜åŒ–å‚æ•°ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿æ¥æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚`Link`æ˜¯ä¿å­˜å‚æ•°ï¼ˆå³ä¼˜åŒ–ç›®æ ‡ï¼‰çš„å¯¹è±¡ã€‚

æœ€åŸºæœ¬çš„æ˜¯åƒå¸¸è§„å‡½æ•°ä¸€æ ·çš„è¿æ¥ã€‚æˆ‘ä»¬å°†ä»‹ç»æ›´é«˜å±‚æ¬¡çš„è¿æ¥ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå°†è¿æ¥çœ‹ä½œç®€åŒ–çš„å¸¦æœ‰å‚æ•°çš„å‡½æ•°ã€‚


æœ€ç»å¸¸ä½¿ç”¨çš„è¿æ¥ä¹‹ä¸€æ˜¯`Linear` è¿æ¥ï¼ˆä¹Ÿç§°ä¸ºå®Œå…¨è¿æ¥å±‚æˆ–ä»¿å°„å˜æ¢ï¼‰ã€‚å®ƒä»£è¡¨ä¸€ä¸ªæ•°å­¦å‡½æ•° $fï¼ˆxï¼‰= Wx + b$
ï¼Œå…¶ä¸­`W`ä¸ºçŸ©é˜µå’Œ`b` ä¸ºçŸ¢é‡å‚æ•°ã€‚è¿™ä¸ªè¿æ¥å¯¹åº”äº`linearï¼ˆï¼‰`ï¼Œå®ƒæ¥å—`x`ï¼Œ`W`ï¼Œ`b` ä½œä¸ºå‚æ•°ã€‚ä»ä¸‰ç»´ç©ºé—´åˆ°äºŒç»´ç©ºé—´çš„çº¿æ€§è¿æ¥ç”±ä»¥ä¸‹è¡Œå®šä¹‰ï¼š



```python
f = L.Linear(3, 2)
```

> å¤§å¤šæ•°å‡½æ•°å’Œé“¾æ¥åªæ¥å—å°æ‰¹é‡è¾“å…¥ï¼Œå…¶ä¸­è¾“å…¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªç»´åº¦è¢«è§†ä¸ºæ‰¹é‡ç»´åº¦ã€‚åœ¨ä¸Šé¢çš„çº¿æ€§è¿æ¥æƒ…å†µä¸‹ï¼Œè¾“å…¥å¿…é¡»å…·æœ‰ï¼ˆNï¼Œ3ï¼‰çš„å½¢çŠ¶ï¼Œå…¶ä¸­Næ˜¯æœ€å°æ‰¹é‡å¤§å°ã€‚

è¿æ¥çš„å‚æ•°è¢«å­˜å‚¨ä¸ºå±æ€§ã€‚æ¯ä¸ªå‚æ•°éƒ½æ˜¯`Variable`çš„ä¸€ä¸ªå®ä¾‹ã€‚åœ¨`Linear`è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå­˜å‚¨ä¸¤ä¸ªå‚æ•°`W`å’Œ`b`ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒçŸ©é˜µ`W`æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œè€Œå‘é‡`b`æ˜¯ç”¨é›¶åˆå§‹åŒ–çš„ã€‚


```python
f.W.data
```




    array([[ 0.19792122,  0.29951876, -0.31833425],
           [-0.59501284, -0.65519476, -0.00605371]], dtype=float32)




```python
f.b.data
```




    array([ 0.,  0.], dtype=float32)



`Linear` è¿æ¥çš„ä¸€ä¸ªå®ä¾‹å°±åƒä¸€ä¸ªé€šå¸¸çš„å‡½æ•°ï¼š


```python
x = Variable(np.array([[1, 2, 3], [4, 5, 6]], dtype=np.float32))
y = f(x)
y.data
```




    array([[-0.15804404, -1.9235636 ],
           [ 0.37927318, -5.69234705]], dtype=float32)



> æœ‰æ—¶è®¡ç®—è¾“å…¥ç©ºé—´çš„ç»´æ•°å¾ˆéº»çƒ¦ã€‚çº¿æ€§è¿æ¥å’Œä¸€äº›ï¼ˆåï¼‰å·ç§¯è¿æ¥å¯ä»¥åœ¨å®ä¾‹åŒ–æ—¶çœç•¥è¾“å…¥ç»´åº¦ï¼Œå¹¶ä»ç¬¬ä¸€ä¸ªå°æ‰¹é‡ä¸­æ¨æ–­å‡ºè¾“å…¥ç»´åº¦æ¥ã€‚

> ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡Œåˆ›å»ºä¸€ä¸ªè¾“å‡ºç»´åº¦ä¸ºä¸¤ä¸ªçš„çº¿æ€§è¿æ¥ï¼š


```python
g = L.Linear(2)
```

>å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå°æ‰¹é‡çš„å½¢çŠ¶ä¸º`ï¼ˆNï¼ŒMï¼‰`ï¼Œåˆ™è¾“å…¥ç»´æ•°å°†è¢«æ¨æ–­ä¸º`M`ï¼Œè¿™æ„å‘³ç€`g.W`å°†æ˜¯`2Ã—M`çŸ©é˜µã€‚ è¯·æ³¨æ„ï¼Œå®ƒçš„å‚æ•°åœ¨ç¬¬ä¸€ä¸ªå°æ‰¹å¤„ç†ä¸­ä»¥æ‡’æƒ°çš„æ–¹å¼åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®æ”¾å…¥è¿æ¥ï¼Œåˆ™`f`ä¸å…·æœ‰`W`å±æ€§ã€‚ 

å‚æ•°çš„æ¢¯åº¦ç”±`backwardï¼ˆï¼‰`æ–¹æ³•è®¡ç®—ã€‚è¯·æ³¨æ„ï¼Œæ¢¯åº¦æ˜¯ç”±æ–¹æ³•ç´¯ç§¯è€Œä¸æ˜¯è¦†ç›–ã€‚æ‰€ä»¥é¦–å…ˆä½ å¿…é¡»æ¸…é™¤æ¢¯åº¦æ¥æ›´æ–°è®¡ç®—ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨`cleargradsï¼ˆï¼‰`æ–¹æ³•æ¥å®Œæˆã€‚


```python
x = Variable(np.array([[1, 2, 3], [4, 5, 6]], dtype=np.float32))
g = L.Linear(2)
p=g(x)
```


```python
p
```




    variable([[-2.64461255,  2.90179563],
              [-6.81166267,  4.94405651]])




```python
g.cleargrads()
```


```python
g.grad = np.ones((2, 2), dtype=np.float32)
```


```python
g.W.grad
```


```python
g.b.grad
```

##  åŸºäº chain å†™ä¸€ä¸ªæ¨¡å‹

å¤§å¤šæ•°ç¥ç»ç½‘ç»œä½“ç³»ç»“æ„åŒ…å«å¤šä¸ªè¿æ¥ã€‚ä¾‹å¦‚ï¼Œå¤šå±‚æ„ŸçŸ¥å™¨ç”±å¤šä¸ªçº¿æ€§å±‚ç»„æˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆå¤šä¸ªè¿æ¥æ¥ç¼–å†™å…·æœ‰å¯è®­ç»ƒå‚æ•°çš„å¤æ‚è¿‡ç¨‹ï¼š



```python
l1 = L.Linear(4, 3)
l2 = L.Linear(3, 2)

def my_forward(x):
    h = l1(x)
    return l2(h)
```

è¿™é‡Œçš„Lè¡¨ç¤º`links`æ¨¡å—ã€‚ä»¥è¿™ç§æ–¹å¼å®šä¹‰å‚æ•°çš„è¿‡ç¨‹å¾ˆéš¾é‡ç”¨ã€‚æ›´å¤šPythonicçš„æ–¹å¼æ˜¯å°†è¿æ¥å’Œç¨‹åºç»„åˆæˆä¸€ä¸ªç±»ï¼š


```python
class MyProc(object):
    def __init__(self):
        self.l1 = L.Linear(4, 3)
        self.l2 = L.Linear(3, 2)

    def forward(self, x):
        h = self.l1(x)
        return self.l2(h)
```

ä¸ºäº†ä½¿å…¶æ›´åŠ å¯é‡ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¯æŒå‚æ•°ç®¡ç†ï¼ŒCPU / GPUè¿ç§»ï¼Œå¼ºå¤§è€Œçµæ´»çš„ä¿å­˜/åŠ è½½åŠŸèƒ½ç­‰ã€‚è¿™äº›åŠŸèƒ½éƒ½ç”±Chainerä¸­çš„`Chain`ç±»æ”¯æŒã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†ä¸Šé¢çš„ç±»å®šä¹‰ä¸º `Chain` çš„å­ç±»ï¼š



```python
class MyChain(Chain):
    def __init__(self):
        super(MyChain, self).__init__()
        with self.init_scope():
            self.l1 = L.Linear(4, 3)
            self.l2 = L.Linear(3, 2)
            
    def __call__(self, x):
        h = self.l1(x)
        return self.l2(h)
```

å®ƒæ˜¾ç¤ºäº†ä¸€ä¸ªå¤æ‚çš„è¿æ¥æ˜¯å¦‚ä½•é€šè¿‡æ›´è¿æ¥çš„é“¾æ¥æ„å»ºçš„ã€‚è¯¸å¦‚`l1`å’Œ`l2`è¢«ç§°ä¸ºMyChainçš„å­è¿æ¥ã€‚æ³¨æ„ï¼Œ`Chain`æœ¬èº«ç»§æ‰¿è‡ª`Link`ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å®šä¹‰æ›´å¤æ‚çš„è¿æ¥ï¼Œå°†MyChainå¯¹è±¡ä½œä¸ºå­è¿æ¥ã€‚


>æˆ‘ä»¬ç»å¸¸é€šè¿‡__call__è¿ç®—ç¬¦å®šä¹‰ä¸€ä¸ªå‰å‘è¿æ¥ã€‚è¿™æ ·çš„è¿æ¥å’ŒChainsæ˜¯å¯è°ƒç”¨çš„ï¼Œå¹¶ä¸”åƒå¸¸è§„å‡½æ•°å’Œå˜é‡ä¸€æ ·ã€‚


å¦ä¸€ç§å®šä¹‰chainçš„æ–¹æ³•æ˜¯ä½¿ç”¨`ChainList`ç±»ï¼Œå®ƒçš„è¡Œä¸ºç±»ä¼¼äºè¿æ¥åˆ—è¡¨ï¼š



```python
class MyChain2(ChainList):
    def __init__(self):
        super(MyChain2, self).__init__(
            L.Linear(4, 3),
            L.Linear(3, 2),
        )

    def __call__(self, x):
        h = self[0](x)
        return self[1](h)
```

`ChainList`å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ä»»æ„æ•°é‡çš„è¿æ¥ï¼Œä½†æ˜¯å¦‚æœè¿æ¥çš„æ•°é‡å›ºå®šä¸”ä¸ä¸Šè¿°æƒ…å†µç›¸åŒï¼Œåˆ™å»ºè®®ä½¿ç”¨`Chain`ç±»ä½œä¸ºåŸºç±»ã€‚


## ä¼˜åŒ–å™¨

ä¸ºäº†è·å¾—è‰¯å¥½çš„å‚æ•°å€¼ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä¼˜åŒ–å™¨ç±»æ¥ä¼˜åŒ–å®ƒä»¬ã€‚å®ƒåœ¨ç»™å®šçš„è¿æ¥ä¸Šè¿è¡Œæ•°å€¼ä¼˜åŒ–ç®—æ³•ã€‚è®¸å¤šç®—æ³•åœ¨ä¼˜åŒ–å™¨æ¨¡å—ä¸­å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€ç®€å•çš„ç§°ä¸ºéšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ï¼š



```python
model = MyChain()
optimizer = optimizers.SGD()
optimizer.setup(model)

```


setupï¼ˆï¼‰æ–¹æ³•é’ˆå¯¹ç»™å®šçš„è¿æ¥å‡†å¤‡å¯¹åº”çš„ä¼˜åŒ–å™¨ã€‚

ä¸€äº›å‚æ•°/æ¢¯åº¦æ“ä½œï¼Œä¾‹å¦‚æƒé‡è¡°å‡å’Œæ¢¯åº¦å‰ªåˆ‡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®é’©å­å‡½æ•°åˆ°ä¼˜åŒ–å™¨æ¥å®Œæˆã€‚ é’©å­å‡½æ•°åœ¨æ¢¯åº¦è®¡ç®—ä¹‹åå’Œå®é™…æ›´æ–°å‚æ•°ä¹‹å‰è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é¢„å…ˆè¿è¡Œä¸‹ä¸€è¡Œæ¥è®¾ç½®æƒé‡è¡°å‡æ­£åˆ™åŒ–ï¼š 


```python
 optimizer.add_hook(chainer.optimizer.WeightDecay(0.0005))
```

å½“ç„¶ï¼Œä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„é’©å­å‡½æ•°ã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œä»¥ä¼˜åŒ–å™¨ä¸ºå‚æ•°ã€‚

æœ‰ä¸¤ç§ä½¿ç”¨ä¼˜åŒ–å™¨çš„æ–¹æ³•ã€‚ä¸€ä¸ªæ˜¯é€šè¿‡è®­ç»ƒå™¨ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­çœ‹åˆ°ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå›é¡¾åä¸€ç§æƒ…å†µã€‚å¦‚æœæ‚¨æœ‰å…´è¶£ä»¥ç®€å•çš„æ–¹å¼ä½¿ç”¨ä¼˜åŒ–å™¨ï¼Œè¯·è·³è¿‡æœ¬èŠ‚å¹¶è½¬åˆ°ä¸‹ä¸€èŠ‚ã€‚

è¿˜æœ‰ä¸¤ç§ç›´æ¥ä½¿ç”¨ä¼˜åŒ–å™¨çš„æ–¹æ³•ã€‚ä¸€ä¸ªæ˜¯æ‰‹åŠ¨è®¡ç®—æ¢¯åº¦ï¼Œç„¶åè°ƒç”¨æ²¡æœ‰å‚æ•°çš„ `updateï¼ˆï¼‰`æ–¹æ³•ã€‚ä¸è¦å¿˜è®°äº‹å…ˆæ¸…é™¤æ¢¯åº¦ï¼



```python
x = np.random.uniform(-1, 1, (2, 4)).astype('f')
model.cleargrads()
# compute gradient here...
loss = F.sum(model(chainer.Variable(x)))
loss.backward()
optimizer.update()
```

å¦ä¸€ç§æ–¹æ³•æ˜¯å°†æŸå¤±å‡½æ•°ä¼ é€’ç»™`updateï¼ˆï¼‰`æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`cleargrads()` ä¼šè¢«updateæ–¹æ³•è‡ªåŠ¨è°ƒç”¨ï¼Œæ‰€ä»¥ç”¨æˆ·ä¸å¿…æ‰‹åŠ¨è°ƒç”¨å®ƒã€‚



```python
def lossfun(arg1, arg2):
    # calculate loss
    loss = F.sum(model(arg1 - arg2))
    return loss
```


```python
arg1 = np.random.uniform(-1, 1, (2, 4)).astype('f')
arg2 = np.random.uniform(-1, 1, (2, 4)).astype('f')
optimizer.update(lossfun, chainer.Variable(arg1), chainer.Variable(arg2))
```

## è®­ç»ƒå™¨

å½“æˆ‘ä»¬æƒ³è¦è®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è¿è¡Œè®­ç»ƒå¾ªç¯å¤šæ¬¡æ›´æ–°å‚æ•°ã€‚å…¸å‹çš„è®­ç»ƒå¾ªç¯åŒ…æ‹¬ä»¥ä¸‹è¿‡ç¨‹ï¼š

1. å¯¹è®­ç»ƒæ•°æ®é›†è¿›è¡Œè¿­ä»£
2. æå–å°æ‰¹é‡çš„é¢„å¤„ç†
3. ç¥ç»ç½‘ç»œçš„å‰å‘/åå‘è®¡ç®—
4. å‚æ•°æ›´æ–°
5. è¯„ä¼°éªŒè¯æ•°æ®é›†ä¸Šçš„å½“å‰å‚æ•°
6. è®°å½•å’Œæ‰“å°ä¸­é—´ç»“æœ

Chaineræä¾›äº†ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„æ–¹æ³•æ¥ä½¿å†™è¿™æ ·çš„è®­ç»ƒè¿‡ç¨‹å˜å¾—å®¹æ˜“ã€‚è®­ç»ƒå¾ªç¯æŠ½è±¡ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š




* **æ•°æ®é›†æŠ½è±¡**ã€‚å®ƒåœ¨ä¸Šé¢çš„åˆ—è¡¨ä¸­å®ç°äº†1å’Œ2ã€‚æ ¸å¿ƒç»„ä»¶åœ¨æ•°æ®é›†æ¨¡å—ä¸­å®šä¹‰ã€‚æ•°æ®é›†å’Œè¿­ä»£å™¨æ¨¡å—ä¸­è¿˜æœ‰è®¸å¤šæ•°æ®é›†å’Œè¿­ä»£å™¨çš„å®ç°ã€‚

* **è®­ç»ƒå™¨**ã€‚å®ƒåœ¨ä¸Šé¢çš„åˆ—è¡¨ä¸­å®ç°3,4,5å’Œ6ã€‚æ•´ä¸ªç¨‹åºç”±Traineræ‰§è¡Œã€‚æ›´æ–°å‚æ•°ï¼ˆ3å’Œ4ï¼‰çš„æ–¹å¼ç”±`Updater`å®šä¹‰ï¼Œå¯ä»¥è‡ªç”±å®šåˆ¶ã€‚ 5å’Œ6ç”±`Extension`çš„å®ä¾‹æ¥å®ç°ï¼Œå®ƒå°†ä¸€ä¸ªé¢å¤–çš„è¿‡ç¨‹é™„åŠ åˆ°è®­ç»ƒå¾ªç¯ä¸­ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ·»åŠ æ‰©å±•æ¥è‡ªç”±å®šåˆ¶è®­ç»ƒç¨‹åºã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„æ‰©å±•ã€‚

## åºåˆ—åŒ–å™¨


åœ¨ç»§ç»­ç¬¬ä¸€ä¸ªä¾‹å­ä¹‹å‰ï¼Œæˆ‘ä»¬ä»‹ç»Serializerï¼Œè¿™æ˜¯æœ¬é¡µä¸­æè¿°çš„æœ€åä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ã€‚åºåˆ—åŒ–å™¨æ˜¯ä¸€ä¸ªç®€å•çš„æ¥å£æ¥åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚è¿æ¥ï¼Œä¼˜åŒ–å™¨å’Œè®­ç»ƒå™¨éƒ½æ”¯æŒåºåˆ—åŒ–ã€‚

åºåˆ—åŒ–å™¨æ¨¡å—ä¸­å®šä¹‰äº†å…·ä½“çš„åºåˆ—åŒ–å™¨ã€‚å®ƒæ”¯æŒNumPy NPZå’ŒHDF5æ ¼å¼ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡serializers.save_npzï¼ˆï¼‰å‡½æ•°å°†è¿æ¥å¯¹è±¡åºåˆ—åŒ–æˆNPZæ–‡ä»¶ï¼š



```python
serializers.save_npz('my.model', model)
```

å®ƒå°†æ¨¡å‹çš„å‚æ•°ä»¥NPZæ ¼å¼ä¿å­˜åˆ°æ–‡ä»¶â€œmy.modelâ€ä¸­ã€‚ä¿å­˜çš„æ¨¡å‹å¯ä»¥è¢«serializers.load_npzï¼ˆï¼‰å‡½æ•°è¯»å–ï¼š


```python
serializers.load_npz('my.model', model)
```

>è¯·æ³¨æ„ï¼Œåªæœ‰å‚æ•°å’ŒæŒä¹…å€¼ç”±è¯¥åºåˆ—åŒ–ä»£ç åºåˆ—åŒ–ã€‚å…¶ä»–å±æ€§ä¸ä¼šè‡ªåŠ¨ä¿å­˜ã€‚æ‚¨å¯ä»¥é€šè¿‡`Link.add_persistentï¼ˆï¼‰`æ–¹æ³•å°†æ•°ç»„ï¼Œæ ‡é‡æˆ–ä»»ä½•å¯åºåˆ—åŒ–çš„å¯¹è±¡æ³¨å†Œä¸ºæŒä¹…å€¼ã€‚æ³¨å†Œçš„å€¼å¯ä»¥é€šè¿‡ä¼ é€’ç»™`add_persistent`æ–¹æ³•çš„åç§°çš„å±æ€§æ¥è®¿é—®ã€‚ 




ä¼˜åŒ–å™¨çš„çŠ¶æ€ä¹Ÿå¯ä»¥é€šè¿‡ç›¸åŒçš„å‡½æ•°æ¥ä¿å­˜ï¼š


```python
serializers.save_npz('my.state', optimizer)
serializers.load_npz('my.state', optimizer)
```

>è¯·æ³¨æ„ï¼Œä¼˜åŒ–å™¨çš„åºåˆ—åŒ–åªä¿å­˜å…¶å†…éƒ¨çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿­ä»£æ¬¡æ•°ï¼ŒMomentumSGDçš„åŠ¨é‡å‘é‡ç­‰ã€‚å®ƒä¸ä¿å­˜ç›®æ ‡è¿æ¥çš„å‚æ•°å’Œæ°¸ä¹…å€¼ã€‚æˆ‘ä»¬å¿…é¡»æ˜ç¡®åœ°ä¿å­˜ä¸ä¼˜åŒ–å™¨çš„ç›®æ ‡è¿æ¥ï¼Œä»ä¿å­˜çŠ¶æ€æ¢å¤ä¼˜åŒ–ã€‚

å¦‚æœå®‰è£…äº†h5pyè½¯ä»¶åŒ…ï¼Œåˆ™æ”¯æŒHDF5æ ¼å¼ã€‚ HDF5æ ¼å¼çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸NPZæ ¼å¼çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å‡ ä¹ç›¸åŒ;åªéœ€ç”¨save_hdf5ï¼ˆï¼‰å’Œload_hdf5ï¼ˆï¼‰åˆ†åˆ«æ›¿æ¢save_npzï¼ˆï¼‰å’Œload_npzï¼ˆï¼‰å³å¯ã€‚



## ä¾‹å­ï¼šåŸºäºMNISTçš„å¤šå±‚æ„ŸçŸ¥å™¨

ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰æ¥è§£å†³å¤šç±»åˆ†ç±»ä»»åŠ¡ã€‚æˆ‘ä»¬ä½¿ç”¨æ‰‹å†™æ•°å­—æ•°æ®é›†ç§°ä¸ºMNISTï¼Œè¿™æ˜¯æœºå™¨å­¦ä¹ ä¸­é•¿æœŸä½¿ç”¨çš„äº‹å®ä¸Šçš„â€œhello worldâ€ç¤ºä¾‹ä¹‹ä¸€ã€‚è¿™ä¸ªMNISTä¾‹å­ä¹Ÿå¯ä»¥åœ¨å®˜æ–¹ä»“åº“çš„examples / mnistç›®å½•ä¸­æ‰¾åˆ°ã€‚æˆ‘ä»¬æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è®­ç»ƒå™¨æ¥æ„å»ºå’Œè¿è¡Œæœ¬èŠ‚ä¸­çš„è®­ç»ƒå¾ªç¯ã€‚

æˆ‘ä»¬é¦–å…ˆå¿…é¡»å‡†å¤‡MNISTæ•°æ®é›†ã€‚ MNISTæ•°æ®é›†ç”±70,000ä¸ªå°ºå¯¸ä¸º28Ã—28ï¼ˆå³784ä¸ªåƒç´ ï¼‰çš„ç°åº¦å›¾åƒå’Œç›¸åº”çš„æ•°å­—æ ‡ç­¾ç»„æˆã€‚æ•°æ®é›†é»˜è®¤åˆ†ä¸º6ä¸‡ä¸ªè®­ç»ƒå›¾åƒå’Œ10,000ä¸ªæµ‹è¯•å›¾åƒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`datasets.get_mnistï¼ˆï¼‰`è·å¾—çŸ¢é‡åŒ–ç‰ˆæœ¬ï¼ˆå³ä¸€ç»„784ç»´å‘é‡ï¼‰ã€‚


```python
train, test = datasets.get_mnist()
```

æ­¤ä»£ç è‡ªåŠ¨ä¸‹è½½MNISTæ•°æ®é›†å¹¶å°†NumPyæ•°ç»„ä¿å­˜åˆ° `$(HOME)/.chainer` ç›®å½•ä¸­ã€‚è¿”å›çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†å¯ä»¥çœ‹ä½œå›¾åƒæ ‡ç­¾é…å¯¹çš„åˆ—è¡¨ï¼ˆä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬æ˜¯TupleDatasetçš„å®ä¾‹ï¼‰ã€‚

æˆ‘ä»¬è¿˜å¿…é¡»å®šä¹‰å¦‚ä½•è¿­ä»£è¿™äº›æ•°æ®é›†ã€‚æˆ‘ä»¬æƒ³è¦åœ¨æ•°æ®é›†çš„æ¯æ¬¡æ‰«æå¼€å§‹æ—¶å¯¹æ¯ä¸ªepochçš„è®­ç»ƒæ•°æ®é›†è¿›è¡Œé‡æ–°æ´—ç‰Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`iterators.SerialIterator`ã€‚


```python
train_iter = iterators.SerialIterator(train, batch_size=100, shuffle=True)
```

å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¸å¿…æ´—ç‰Œæµ‹è¯•æ•°æ®é›†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡shuffle = Falseæ¥ç¦æ­¢æ··æ´—ã€‚å½“åº•å±‚æ•°æ®é›†æ”¯æŒå¿«é€Ÿåˆ‡ç‰‡æ—¶ï¼Œå®ƒä½¿è¿­ä»£é€Ÿåº¦æ›´å¿«ã€‚


```python
test_iter = iterators.SerialIterator(test, batch_size=100, repeat=False, shuffle=False)
```

å½“æ‰€æœ‰çš„ä¾‹å­è¢«è®¿é—®æ—¶ï¼Œæˆ‘ä»¬åœæ­¢è¿­ä»£é€šè¿‡è®¾å®š repeat=False ã€‚æµ‹è¯•/éªŒè¯æ•°æ®é›†é€šå¸¸éœ€è¦æ­¤é€‰é¡¹;æ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œè¿­ä»£è¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰æ¶æ„ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¸‰å±‚ç½‘ç»œï¼Œæ¯å±‚100ä¸ªå•å…ƒã€‚


```python
class MLP(Chain):
    def __init__(self, n_units, n_out):
        super(MLP, self).__init__()
        with self.init_scope():
            # the size of the inputs to each layer will be inferred
            self.l1 = L.Linear(None, n_units)  # n_in -> n_units
            self.l2 = L.Linear(None, n_units)  # n_units -> n_units
            self.l3 = L.Linear(None, n_out)    # n_units -> n_out

    def __call__(self, x):
        h1 = F.relu(self.l1(x))
        h2 = F.relu(self.l2(h1))
        y = self.l3(h2)
        return y
```

è¯¥é“¾æ¥ä½¿ç”¨reluï¼ˆï¼‰ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚è¯·æ³¨æ„ï¼Œâ€œl3â€é“¾æ¥æ˜¯æœ€ç»ˆçš„å…¨è¿æ¥å±‚ï¼Œå…¶è¾“å‡ºå¯¹åº”äºåä¸ªæ•°å­—çš„åˆ†æ•°ã€‚

ä¸ºäº†è®¡ç®—æŸå¤±å€¼æˆ–è¯„ä¼°é¢„æµ‹çš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„MLPè¿æ¥çš„åŸºç¡€ä¸Šå®šä¹‰ä¸€ä¸ªåˆ†ç±»å™¨è¿æ¥ï¼š


```python
class Classifier(Chain):
    def __init__(self, predictor):
        super(Classifier, self).__init__()
        with self.init_scope():
            self.predictor = predictor

    def __call__(self, x, t):
        y = self.predictor(x)
        loss = F.softmax_cross_entropy(y, t)
        accuracy = F.accuracy(y, t)
        report({'loss': loss, 'accuracy': accuracy}, self)
        return loss
```

è¿™ä¸ªåˆ†ç±»å™¨ç±»è®¡ç®—å‡†ç¡®æ€§å’ŒæŸå¤±ï¼Œå¹¶è¿”å›æŸå¤±å€¼ã€‚å‚æ•°å¯¹xå’Œtå¯¹åº”äºæ•°æ®é›†ä¸­çš„æ¯ä¸ªç¤ºä¾‹ï¼ˆå›¾åƒå’Œæ ‡ç­¾çš„å…ƒç»„ï¼‰ã€‚ `softmax_cross_entropyï¼ˆï¼‰`è®¡ç®—ç»™å®šé¢„æµ‹å’ŒåŸºå‡†çœŸå®æ ‡ç­¾çš„æŸå¤±å€¼ã€‚ `accuracy() `è®¡ç®—é¢„æµ‹å‡†ç¡®åº¦ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºåˆ†ç±»å™¨çš„ä¸€ä¸ªå®ä¾‹è®¾ç½®ä»»æ„çš„é¢„æµ‹å™¨è¿æ¥ã€‚ 

`report()` å‡½æ•°å‘è®­ç»ƒå™¨æŠ¥å‘ŠæŸå¤±å’Œå‡†ç¡®åº¦ã€‚æ”¶é›†è®­ç»ƒç»Ÿè®¡ä¿¡æ¯çš„å…·ä½“æœºåˆ¶å‚è§ `Reporter`. æ‚¨ä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„æ–¹å¼æ”¶é›†å…¶ä»–ç±»å‹çš„è§‚æµ‹å€¼ï¼Œå¦‚æ¿€æ´»ç»Ÿè®¡ã€‚

è¯·æ³¨æ„ï¼Œç±»ä¼¼ä¸Šé¢çš„åˆ†ç±»å™¨çš„ç±»è¢«å®šä¹‰ä¸º`chainer.links.Classifier`ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­¤é¢„å®šä¹‰çš„`Classifier`è¿æ¥è€Œä¸æ˜¯ä½¿ç”¨ä¸Šé¢çš„ç¤ºä¾‹ã€‚



```python
model = L.Classifier(MLP(100, 10))  # the input size, 784, is inferred
optimizer = optimizers.SGD()
optimizer.setup(model)
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªè®­ç»ƒå™¨å¯¹è±¡ã€‚



```python
updater = training.StandardUpdater(train_iter, optimizer)
trainer = training.Trainer(updater, (20, 'epoch'), out='result')
```

ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ20ï¼Œ'epoch'ï¼‰è¡¨ç¤ºè®­ç»ƒçš„æŒç»­æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨epochæˆ–è¿­ä»£ä½œä¸ºå•ä½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡éå†è®­ç»ƒé›†20æ¬¡æ¥è®­ç»ƒå¤šå±‚æ„ŸçŸ¥å™¨ã€‚

ä¸ºäº†è°ƒç”¨è®­ç»ƒå¾ªç¯ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨runï¼ˆï¼‰æ–¹æ³•ã€‚

è¿™ä¸ªæ–¹æ³•æ‰§è¡Œæ•´ä¸ªè®­ç»ƒåºåˆ—ã€‚

ä¸Šé¢çš„ä»£ç åªæ˜¯ä¼˜åŒ–äº†å‚æ•°ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³çœ‹çœ‹åŸ¹è®­çš„è¿›å±•æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨runæ–¹æ³•ä¹‹å‰ä½¿ç”¨æ‰©å±•æ’å…¥ã€‚





```python
trainer.extend(extensions.Evaluator(test_iter, model))
trainer.extend(extensions.LogReport())
trainer.extend(extensions.PrintReport(['epoch', 'main/accuracy', 'validation/main/accuracy']))
trainer.extend(extensions.ProgressBar())
trainer.run()  
```

    epoch       main/accuracy  validation/main/accuracy
    [J     total [..................................................]  0.83%
    this epoch [########..........................................] 16.67%
           100 iter, 0 epoch / 20 epochs
           inf iters/sec. Estimated time to finish: 0:00:00.
    [4A[J     total [..................................................]  1.67%
    this epoch [################..................................] 33.33%
           200 iter, 0 epoch / 20 epochs
        270.19 iters/sec. Estimated time to finish: 0:00:43.672168.
    [4A[J     total [#.................................................]  2.50%
    this epoch [#########################.........................] 50.00%
           300 iter, 0 epoch / 20 epochs
        271.99 iters/sec. Estimated time to finish: 0:00:43.017048.
    [4A[J     total [#.................................................]  3.33%
    this epoch [#################################.................] 66.67%
           400 iter, 0 epoch / 20 epochs
        274.82 iters/sec. Estimated time to finish: 0:00:42.209075.
    [4A[J     total [##................................................]  4.17%
    this epoch [#########################################.........] 83.33%
           500 iter, 0 epoch / 20 epochs
        275.19 iters/sec. Estimated time to finish: 0:00:41.789476.
    [4A[J1           0.6581         0.8475                    
    [J     total [##................................................]  5.00%
    this epoch [..................................................]  0.00%
           600 iter, 1 epoch / 20 epochs
        250.26 iters/sec. Estimated time to finish: 0:00:45.553447.
    [4A[J     total [##................................................]  5.83%
    this epoch [########..........................................] 16.67%
           700 iter, 1 epoch / 20 epochs
        251.78 iters/sec. Estimated time to finish: 0:00:44.879872.
    [4A[J     total [###...............................................]  6.67%
    this epoch [################..................................] 33.33%
           800 iter, 1 epoch / 20 epochs
        253.07 iters/sec. Estimated time to finish: 0:00:44.257362.
    [4A[J     total [###...............................................]  7.50%
    this epoch [#########################.........................] 50.00%
           900 iter, 1 epoch / 20 epochs
        253.97 iters/sec. Estimated time to finish: 0:00:43.706513.
    [4A[J     total [####..............................................]  8.33%
    this epoch [#################################.................] 66.67%
          1000 iter, 1 epoch / 20 epochs
        255.94 iters/sec. Estimated time to finish: 0:00:42.979372.
    [4A[J     total [####..............................................]  9.17%
    this epoch [#########################################.........] 83.33%
          1100 iter, 1 epoch / 20 epochs
        257.61 iters/sec. Estimated time to finish: 0:00:42.311793.
    [4A[J2           0.868483       0.8922                    
    [J     total [#####.............................................] 10.00%
    this epoch [..................................................]  0.00%
          1200 iter, 2 epoch / 20 epochs
        250.02 iters/sec. Estimated time to finish: 0:00:43.196043.
    [4A[J     total [#####.............................................] 10.83%
    this epoch [########..........................................] 16.67%
          1300 iter, 2 epoch / 20 epochs
        250.73 iters/sec. Estimated time to finish: 0:00:42.674737.
    [4A[J     total [#####.............................................] 11.67%
    this epoch [################..................................] 33.33%
          1400 iter, 2 epoch / 20 epochs
        250.76 iters/sec. Estimated time to finish: 0:00:42.271780.
    [4A[J     total [######............................................] 12.50%
    this epoch [#########################.........................] 50.00%
          1500 iter, 2 epoch / 20 epochs
        250.66 iters/sec. Estimated time to finish: 0:00:41.889907.
    [4A[J     total [######............................................] 13.33%
    this epoch [#################################.................] 66.67%
          1600 iter, 2 epoch / 20 epochs
        250.63 iters/sec. Estimated time to finish: 0:00:41.494966.
    [4A[J     total [#######...........................................] 14.17%
    this epoch [#########################################.........] 83.33%
          1700 iter, 2 epoch / 20 epochs
         250.3 iters/sec. Estimated time to finish: 0:00:41.150503.
    [4A[J3           0.893583       0.9065                    
    [J     total [#######...........................................] 15.00%
    this epoch [..................................................]  0.00%
          1800 iter, 3 epoch / 20 epochs
        245.03 iters/sec. Estimated time to finish: 0:00:41.627412.
    [4A[J     total [#######...........................................] 15.83%
    this epoch [########..........................................] 16.67%
          1900 iter, 3 epoch / 20 epochs
        246.29 iters/sec. Estimated time to finish: 0:00:41.007745.
    [4A[J     total [########..........................................] 16.67%
    this epoch [################..................................] 33.33%
          2000 iter, 3 epoch / 20 epochs
        246.63 iters/sec. Estimated time to finish: 0:00:40.547184.
    [4A[J     total [########..........................................] 17.50%
    this epoch [#########################.........................] 50.00%
          2100 iter, 3 epoch / 20 epochs
        247.22 iters/sec. Estimated time to finish: 0:00:40.045529.
    [4A[J     total [#########.........................................] 18.33%
    this epoch [#################################.................] 66.67%
          2200 iter, 3 epoch / 20 epochs
        248.21 iters/sec. Estimated time to finish: 0:00:39.482367.
    [4A[J     total [#########.........................................] 19.17%
    this epoch [#########################################.........] 83.33%
          2300 iter, 3 epoch / 20 epochs
        248.73 iters/sec. Estimated time to finish: 0:00:38.997955.
    [4A[J4           0.90485        0.9154                    
    [J     total [##########........................................] 20.00%
    this epoch [..................................................]  0.00%
          2400 iter, 4 epoch / 20 epochs
        244.21 iters/sec. Estimated time to finish: 0:00:39.309754.
    [4A[J     total [##########........................................] 20.83%
    this epoch [########..........................................] 16.67%
          2500 iter, 4 epoch / 20 epochs
        244.55 iters/sec. Estimated time to finish: 0:00:38.847329.
    [4A[J     total [##########........................................] 21.67%
    this epoch [################..................................] 33.33%
          2600 iter, 4 epoch / 20 epochs
        245.78 iters/sec. Estimated time to finish: 0:00:38.245938.
    [4A[J     total [###########.......................................] 22.50%
    this epoch [#########################.........................] 50.00%
          2700 iter, 4 epoch / 20 epochs
        246.89 iters/sec. Estimated time to finish: 0:00:37.668330.
    [4A[J     total [###########.......................................] 23.33%
    this epoch [#################################.................] 66.67%
          2800 iter, 4 epoch / 20 epochs
        247.85 iters/sec. Estimated time to finish: 0:00:37.119132.
    [4A[J     total [############......................................] 24.17%
    this epoch [#########################################.........] 83.33%
          2900 iter, 4 epoch / 20 epochs
        248.84 iters/sec. Estimated time to finish: 0:00:36.568961.
    [4A[J5           0.9128         0.9222                    
    [J     total [############......................................] 25.00%
    this epoch [..................................................]  0.00%
          3000 iter, 5 epoch / 20 epochs
        246.32 iters/sec. Estimated time to finish: 0:00:36.537719.
    [4A[J     total [############......................................] 25.83%
    this epoch [########..........................................] 16.67%
          3100 iter, 5 epoch / 20 epochs
        247.27 iters/sec. Estimated time to finish: 0:00:35.993611.
    [4A[J     total [#############.....................................] 26.67%
    this epoch [################..................................] 33.33%
          3200 iter, 5 epoch / 20 epochs
        247.64 iters/sec. Estimated time to finish: 0:00:35.535495.
    [4A[J     total [#############.....................................] 27.50%
    this epoch [#########################.........................] 50.00%
          3300 iter, 5 epoch / 20 epochs
        248.02 iters/sec. Estimated time to finish: 0:00:35.078297.
    [4A[J     total [##############....................................] 28.33%
    this epoch [#################################.................] 66.67%
          3400 iter, 5 epoch / 20 epochs
         248.3 iters/sec. Estimated time to finish: 0:00:34.635942.
    [4A[J     total [##############....................................] 29.17%
    this epoch [#########################################.........] 83.33%
          3500 iter, 5 epoch / 20 epochs
        248.35 iters/sec. Estimated time to finish: 0:00:34.225545.
    [4A[J6           0.9182         0.9251                    
    [J     total [###############...................................] 30.00%
    this epoch [..................................................]  0.00%
          3600 iter, 6 epoch / 20 epochs
        245.49 iters/sec. Estimated time to finish: 0:00:34.217710.
    [4A[J     total [###############...................................] 30.83%
    this epoch [########..........................................] 16.67%
          3700 iter, 6 epoch / 20 epochs
        245.88 iters/sec. Estimated time to finish: 0:00:33.755860.
    [4A[J     total [###############...................................] 31.67%
    this epoch [################..................................] 33.33%
          3800 iter, 6 epoch / 20 epochs
         245.9 iters/sec. Estimated time to finish: 0:00:33.346716.
    [4A[J     total [################..................................] 32.50%
    this epoch [#########################.........................] 50.00%
          3900 iter, 6 epoch / 20 epochs
        245.96 iters/sec. Estimated time to finish: 0:00:32.931534.
    [4A[J     total [################..................................] 33.33%
    this epoch [#################################.................] 66.67%
          4000 iter, 6 epoch / 20 epochs
        245.99 iters/sec. Estimated time to finish: 0:00:32.521949.
    [4A[J     total [#################.................................] 34.17%
    this epoch [#########################################.........] 83.33%
          4100 iter, 6 epoch / 20 epochs
        246.12 iters/sec. Estimated time to finish: 0:00:32.098613.
    [4A[J7           0.923683       0.9281                    
    [J     total [#################.................................] 35.00%
    this epoch [..................................................]  0.00%
          4200 iter, 7 epoch / 20 epochs
        244.37 iters/sec. Estimated time to finish: 0:00:31.918388.
    [4A[J     total [#################.................................] 35.83%
    this epoch [########..........................................] 16.67%
          4300 iter, 7 epoch / 20 epochs
        244.24 iters/sec. Estimated time to finish: 0:00:31.526645.
    [4A[J     total [##################................................] 36.67%
    this epoch [################..................................] 33.33%
          4400 iter, 7 epoch / 20 epochs
         244.7 iters/sec. Estimated time to finish: 0:00:31.058855.
    [4A[J     total [##################................................] 37.50%
    this epoch [#########################.........................] 50.00%
          4500 iter, 7 epoch / 20 epochs
        245.22 iters/sec. Estimated time to finish: 0:00:30.584594.
    [4A[J     total [###################...............................] 38.33%
    this epoch [#################################.................] 66.67%
          4600 iter, 7 epoch / 20 epochs
        245.84 iters/sec. Estimated time to finish: 0:00:30.100470.
    [4A[J     total [###################...............................] 39.17%
    this epoch [#########################################.........] 83.33%
          4700 iter, 7 epoch / 20 epochs
         246.3 iters/sec. Estimated time to finish: 0:00:29.638363.
    [4A[J8           0.927233       0.9312                    
    [J     total [####################..............................] 40.00%
    this epoch [..................................................]  0.00%
          4800 iter, 8 epoch / 20 epochs
        245.02 iters/sec. Estimated time to finish: 0:00:29.385524.
    [4A[J     total [####################..............................] 40.83%
    this epoch [########..........................................] 16.67%
          4900 iter, 8 epoch / 20 epochs
        245.47 iters/sec. Estimated time to finish: 0:00:28.923795.
    [4A[J     total [####################..............................] 41.67%
    this epoch [################..................................] 33.33%
          5000 iter, 8 epoch / 20 epochs
        245.91 iters/sec. Estimated time to finish: 0:00:28.465973.
    [4A[J     total [#####################.............................] 42.50%
    this epoch [#########################.........................] 50.00%
          5100 iter, 8 epoch / 20 epochs
        246.47 iters/sec. Estimated time to finish: 0:00:27.994909.
    [4A[J     total [#####################.............................] 43.33%
    this epoch [#################################.................] 66.67%
          5200 iter, 8 epoch / 20 epochs
        246.95 iters/sec. Estimated time to finish: 0:00:27.535404.
    [4A[J     total [######################............................] 44.17%
    this epoch [#########################################.........] 83.33%
          5300 iter, 8 epoch / 20 epochs
        247.33 iters/sec. Estimated time to finish: 0:00:27.089584.
    [4A[J9           0.931317       0.9341                    
    [J     total [######################............................] 45.00%
    this epoch [..................................................]  0.00%
          5400 iter, 9 epoch / 20 epochs
        245.58 iters/sec. Estimated time to finish: 0:00:26.874639.
    [4A[J     total [######################............................] 45.83%
    this epoch [########..........................................] 16.67%
          5500 iter, 9 epoch / 20 epochs
        245.87 iters/sec. Estimated time to finish: 0:00:26.437190.
    [4A[J     total [#######################...........................] 46.67%
    this epoch [################..................................] 33.33%
          5600 iter, 9 epoch / 20 epochs
        246.33 iters/sec. Estimated time to finish: 0:00:25.981189.
    [4A[J     total [#######################...........................] 47.50%
    this epoch [#########################.........................] 50.00%
          5700 iter, 9 epoch / 20 epochs
        246.78 iters/sec. Estimated time to finish: 0:00:25.528408.
    [4A[J     total [########################..........................] 48.33%
    this epoch [#################################.................] 66.67%
          5800 iter, 9 epoch / 20 epochs
         247.2 iters/sec. Estimated time to finish: 0:00:25.080847.
    [4A[J     total [########################..........................] 49.17%
    this epoch [#########################################.........] 83.33%
          5900 iter, 9 epoch / 20 epochs
        247.69 iters/sec. Estimated time to finish: 0:00:24.627826.
    [4A[J10          0.934733       0.9369                    
    [J     total [#########################.........................] 50.00%
    this epoch [..................................................]  0.00%
          6000 iter, 10 epoch / 20 epochs
        246.59 iters/sec. Estimated time to finish: 0:00:24.332159.
    [4A[J     total [#########################.........................] 50.83%
    this epoch [########..........................................] 16.67%
          6100 iter, 10 epoch / 20 epochs
           247 iters/sec. Estimated time to finish: 0:00:23.886641.
    [4A[J     total [#########################.........................] 51.67%
    this epoch [################..................................] 33.33%
          6200 iter, 10 epoch / 20 epochs
        247.36 iters/sec. Estimated time to finish: 0:00:23.448076.
    [4A[J     total [##########################........................] 52.50%
    this epoch [#########################.........................] 50.00%
          6300 iter, 10 epoch / 20 epochs
        247.73 iters/sec. Estimated time to finish: 0:00:23.008541.
    [4A[J     total [##########################........................] 53.33%
    this epoch [#################################.................] 66.67%
          6400 iter, 10 epoch / 20 epochs
        248.16 iters/sec. Estimated time to finish: 0:00:22.566452.
    [4A[J     total [###########################.......................] 54.17%
    this epoch [#########################################.........] 83.33%
          6500 iter, 10 epoch / 20 epochs
        248.61 iters/sec. Estimated time to finish: 0:00:22.123234.
    [4A[J11          0.937883       0.9414                    
    [J     total [###########################.......................] 55.00%
    this epoch [..................................................]  0.00%
          6600 iter, 11 epoch / 20 epochs
        247.52 iters/sec. Estimated time to finish: 0:00:21.816101.
    [4A[J     total [###########################.......................] 55.83%
    this epoch [########..........................................] 16.67%
          6700 iter, 11 epoch / 20 epochs
        247.67 iters/sec. Estimated time to finish: 0:00:21.399559.
    [4A[J     total [############################......................] 56.67%
    this epoch [################..................................] 33.33%
          6800 iter, 11 epoch / 20 epochs
        247.88 iters/sec. Estimated time to finish: 0:00:20.977519.
    [4A[J     total [############################......................] 57.50%
    this epoch [#########################.........................] 50.00%
          6900 iter, 11 epoch / 20 epochs
        248.13 iters/sec. Estimated time to finish: 0:00:20.553526.
    [4A[J     total [#############################.....................] 58.33%
    this epoch [#################################.................] 66.67%
          7000 iter, 11 epoch / 20 epochs
        248.28 iters/sec. Estimated time to finish: 0:00:20.138771.
    [4A[J     total [#############################.....................] 59.17%
    this epoch [#########################################.........] 83.33%
          7100 iter, 11 epoch / 20 epochs
        248.42 iters/sec. Estimated time to finish: 0:00:19.724508.
    [4A[J12          0.940583       0.9438                    
    [J     total [##############################....................] 60.00%
    this epoch [..................................................]  0.00%
          7200 iter, 12 epoch / 20 epochs
        247.45 iters/sec. Estimated time to finish: 0:00:19.398094.
    [4A[J     total [##############################....................] 60.83%
    this epoch [########..........................................] 16.67%
          7300 iter, 12 epoch / 20 epochs
        247.79 iters/sec. Estimated time to finish: 0:00:18.967364.
    [4A[J     total [##############################....................] 61.67%
    this epoch [################..................................] 33.33%
          7400 iter, 12 epoch / 20 epochs
         248.1 iters/sec. Estimated time to finish: 0:00:18.540794.
    [4A[J     total [###############################...................] 62.50%
    this epoch [#########################.........................] 50.00%
          7500 iter, 12 epoch / 20 epochs
        248.46 iters/sec. Estimated time to finish: 0:00:18.111734.
    [4A[J     total [###############################...................] 63.33%
    this epoch [#################################.................] 66.67%
          7600 iter, 12 epoch / 20 epochs
        248.77 iters/sec. Estimated time to finish: 0:00:17.687175.
    [4A[J     total [################################..................] 64.17%
    this epoch [#########################################.........] 83.33%
          7700 iter, 12 epoch / 20 epochs
        249.07 iters/sec. Estimated time to finish: 0:00:17.264007.
    [4A[J13          0.942633       0.9451                    
    [J     total [################################..................] 65.00%
    this epoch [..................................................]  0.00%
          7800 iter, 13 epoch / 20 epochs
        248.22 iters/sec. Estimated time to finish: 0:00:16.920387.
    [4A[J     total [################################..................] 65.83%
    this epoch [########..........................................] 16.67%
          7900 iter, 13 epoch / 20 epochs
        248.52 iters/sec. Estimated time to finish: 0:00:16.497482.
    [4A[J     total [#################################.................] 66.67%
    this epoch [################..................................] 33.33%
          8000 iter, 13 epoch / 20 epochs
        248.86 iters/sec. Estimated time to finish: 0:00:16.073042.
    [4A[J     total [#################################.................] 67.50%
    this epoch [#########################.........................] 50.00%
          8100 iter, 13 epoch / 20 epochs
         249.2 iters/sec. Estimated time to finish: 0:00:15.649976.
    [4A[J     total [##################################................] 68.33%
    this epoch [#################################.................] 66.67%
          8200 iter, 13 epoch / 20 epochs
        249.47 iters/sec. Estimated time to finish: 0:00:15.232395.
    [4A[J     total [##################################................] 69.17%
    this epoch [#########################################.........] 83.33%
          8300 iter, 13 epoch / 20 epochs
        249.72 iters/sec. Estimated time to finish: 0:00:14.816816.
    [4A[J14          0.945083       0.9465                    
    [J     total [###################################...............] 70.00%
    this epoch [..................................................]  0.00%
          8400 iter, 14 epoch / 20 epochs
        248.89 iters/sec. Estimated time to finish: 0:00:14.463988.
    [4A[J     total [###################################...............] 70.83%
    this epoch [########..........................................] 16.67%
          8500 iter, 14 epoch / 20 epochs
        249.19 iters/sec. Estimated time to finish: 0:00:14.045501.
    [4A[J     total [###################################...............] 71.67%
    this epoch [################..................................] 33.33%
          8600 iter, 14 epoch / 20 epochs
        249.44 iters/sec. Estimated time to finish: 0:00:13.630462.
    [4A[J     total [####################################..............] 72.50%
    this epoch [#########################.........................] 50.00%
          8700 iter, 14 epoch / 20 epochs
        249.64 iters/sec. Estimated time to finish: 0:00:13.219213.
    [4A[J     total [####################################..............] 73.33%
    this epoch [#################################.................] 66.67%
          8800 iter, 14 epoch / 20 epochs
        249.92 iters/sec. Estimated time to finish: 0:00:12.804288.
    [4A[J     total [#####################################.............] 74.17%
    this epoch [#########################################.........] 83.33%
          8900 iter, 14 epoch / 20 epochs
        250.18 iters/sec. Estimated time to finish: 0:00:12.390956.
    [4A[J15          0.947233       0.9495                    
    [J     total [#####################################.............] 75.00%
    this epoch [..................................................]  0.00%
          9000 iter, 15 epoch / 20 epochs
         249.4 iters/sec. Estimated time to finish: 0:00:12.028884.
    [4A[J     total [#####################################.............] 75.83%
    this epoch [########..........................................] 16.67%
          9100 iter, 15 epoch / 20 epochs
        249.64 iters/sec. Estimated time to finish: 0:00:11.616690.
    [4A[J     total [######################################............] 76.67%
    this epoch [################..................................] 33.33%
          9200 iter, 15 epoch / 20 epochs
        249.92 iters/sec. Estimated time to finish: 0:00:11.203418.
    [4A[J     total [######################################............] 77.50%
    this epoch [#########################.........................] 50.00%
          9300 iter, 15 epoch / 20 epochs
        250.17 iters/sec. Estimated time to finish: 0:00:10.792487.
    [4A[J     total [#######################################...........] 78.33%
    this epoch [#################################.................] 66.67%
          9400 iter, 15 epoch / 20 epochs
        250.43 iters/sec. Estimated time to finish: 0:00:10.382150.
    [4A[J     total [#######################################...........] 79.17%
    this epoch [#########################################.........] 83.33%
          9500 iter, 15 epoch / 20 epochs
        250.59 iters/sec. Estimated time to finish: 0:00:09.976316.
    [4A[J16          0.949033       0.9496                    
    [J     total [########################################..........] 80.00%
    this epoch [..................................................]  0.00%
          9600 iter, 16 epoch / 20 epochs
        249.87 iters/sec. Estimated time to finish: 0:00:09.605143.
    [4A[J     total [########################################..........] 80.83%
    this epoch [########..........................................] 16.67%
          9700 iter, 16 epoch / 20 epochs
        250.05 iters/sec. Estimated time to finish: 0:00:09.197988.
    [4A[J     total [########################################..........] 81.67%
    this epoch [################..................................] 33.33%
          9800 iter, 16 epoch / 20 epochs
        250.32 iters/sec. Estimated time to finish: 0:00:08.788854.
    [4A[J     total [#########################################.........] 82.50%
    this epoch [#########################.........................] 50.00%
          9900 iter, 16 epoch / 20 epochs
        250.58 iters/sec. Estimated time to finish: 0:00:08.380646.
    [4A[J     total [#########################################.........] 83.33%
    this epoch [#################################.................] 66.67%
         10000 iter, 16 epoch / 20 epochs
        250.77 iters/sec. Estimated time to finish: 0:00:07.975449.
    [4A[J     total [##########################################........] 84.17%
    this epoch [#########################################.........] 83.33%
         10100 iter, 16 epoch / 20 epochs
        251.01 iters/sec. Estimated time to finish: 0:00:07.569486.
    [4A[J17          0.9507         0.9526                    
    [J     total [##########################################........] 85.00%
    this epoch [..................................................]  0.00%
         10200 iter, 17 epoch / 20 epochs
        250.13 iters/sec. Estimated time to finish: 0:00:07.196375.
    [4A[J     total [##########################################........] 85.83%
    this epoch [########..........................................] 16.67%
         10300 iter, 17 epoch / 20 epochs
        250.15 iters/sec. Estimated time to finish: 0:00:06.795972.
    [4A[J     total [###########################################.......] 86.67%
    this epoch [################..................................] 33.33%
         10400 iter, 17 epoch / 20 epochs
        250.12 iters/sec. Estimated time to finish: 0:00:06.397005.
    [4A[J     total [###########################################.......] 87.50%
    this epoch [#########################.........................] 50.00%
         10500 iter, 17 epoch / 20 epochs
        250.15 iters/sec. Estimated time to finish: 0:00:05.996337.
    [4A[J     total [############################################......] 88.33%
    this epoch [#################################.................] 66.67%
         10600 iter, 17 epoch / 20 epochs
        251.26 iters/sec. Estimated time to finish: 0:00:05.571862.
    [4A[J     total [############################################......] 89.17%
    this epoch [#########################################.........] 83.33%
         10700 iter, 17 epoch / 20 epochs
        251.44 iters/sec. Estimated time to finish: 0:00:05.170228.
    [4A[J18          0.952383       0.9532                    
    [J     total [#############################################.....] 90.00%
    this epoch [..................................................]  0.00%
         10800 iter, 18 epoch / 20 epochs
        250.63 iters/sec. Estimated time to finish: 0:00:04.787898.
    [4A[J     total [#############################################.....] 90.83%
    this epoch [########..........................................] 16.67%
         10900 iter, 18 epoch / 20 epochs
        250.76 iters/sec. Estimated time to finish: 0:00:04.386683.
    [4A[J     total [#############################################.....] 91.67%
    this epoch [################..................................] 33.33%
         11000 iter, 18 epoch / 20 epochs
         250.8 iters/sec. Estimated time to finish: 0:00:03.987294.
    [4A[J     total [##############################################....] 92.50%
    this epoch [#########################.........................] 50.00%
         11100 iter, 18 epoch / 20 epochs
        250.85 iters/sec. Estimated time to finish: 0:00:03.587843.
    [4A[J     total [##############################################....] 93.33%
    this epoch [#################################.................] 66.67%
         11200 iter, 18 epoch / 20 epochs
        251.83 iters/sec. Estimated time to finish: 0:00:03.176797.
    [4A[J     total [###############################################...] 94.17%
    this epoch [#########################################.........] 83.33%
         11300 iter, 18 epoch / 20 epochs
           252 iters/sec. Estimated time to finish: 0:00:02.777783.
    [4A[J19          0.953817       0.953                     
    [J     total [###############################################...] 95.00%
    this epoch [..................................................]  0.00%
         11400 iter, 19 epoch / 20 epochs
        251.32 iters/sec. Estimated time to finish: 0:00:02.387425.
    [4A[J     total [###############################################...] 95.83%
    this epoch [########..........................................] 16.67%
         11500 iter, 19 epoch / 20 epochs
        251.59 iters/sec. Estimated time to finish: 0:00:01.987384.
    [4A[J     total [################################################..] 96.67%
    this epoch [################..................................] 33.33%
         11600 iter, 19 epoch / 20 epochs
        251.86 iters/sec. Estimated time to finish: 0:00:01.588182.
    [4A[J     total [################################################..] 97.50%
    this epoch [#########################.........................] 50.00%
         11700 iter, 19 epoch / 20 epochs
        252.12 iters/sec. Estimated time to finish: 0:00:01.189929.
    [4A[J     total [#################################################.] 98.33%
    this epoch [#################################.................] 66.67%
         11800 iter, 19 epoch / 20 epochs
        253.16 iters/sec. Estimated time to finish: 0:00:00.790023.
    [4A[J     total [#################################################.] 99.17%
    this epoch [#########################################.........] 83.33%
         11900 iter, 19 epoch / 20 epochs
         253.1 iters/sec. Estimated time to finish: 0:00:00.395094.
    [4A[J20          0.95535        0.9551                    
    [J     total [##################################################] 100.00%
    this epoch [..................................................]  0.00%
         12000 iter, 20 epoch / 20 epochs
        252.37 iters/sec. Estimated time to finish: 0:00:00.
    [4A[J

è¿™äº›æ‰©å±•æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

* Evaluator
åœ¨æ¯ä¸ªepoch ç»“æŸæ—¶åŸºäºæµ‹è¯•æ•°æ®é›†è¯„ä¼°å½“å‰æ¨¡å‹ã€‚å®ƒä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æµ‹è¯•æ¨¡å¼ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…ä¸ºåœ¨è®­ç»ƒ/æµ‹è¯•æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œdropoutï¼ˆï¼‰ï¼ŒBatchNormalizationï¼‰ä¸­è¡¨ç°ä¸åŒçš„æ¨¡å¼é‡‡å–ä»»ä½•ç‰¹æ®Šçš„åŠŸèƒ½ã€‚

* LogReport
æ±‡æ€»è¦æŠ¥å‘Šçš„æ•°å€¼å¹¶å°†å…¶å‘é€åˆ°è¾“å‡ºç›®å½•ä¸­çš„æ—¥å¿—æ–‡ä»¶ã€‚

* PrintReport
åœ¨LogReportä¸­æ‰“å°é€‰å®šçš„é¡¹ç›®ã€‚

* ProgressBar
æ˜¾ç¤ºè¿›åº¦æ¡ã€‚

åœ¨chainer.training.extensionsæ¨¡å—ä¸­å®ç°äº†è®¸å¤šæ‰©å±•ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªå°±æ˜¯snapshotï¼ˆï¼‰ï¼Œå®ƒå°†è®­ç»ƒè¿‡ç¨‹çš„å¿«ç…§ï¼ˆå³Trainerå¯¹è±¡ï¼‰ä¿å­˜åˆ°è¾“å‡ºç›®å½•ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

examples / mnistç›®å½•ä¸­çš„ç¤ºä¾‹ä»£ç è¿˜åŒ…å«GPUæ”¯æŒï¼Œå°½ç®¡å…¶åŸºæœ¬éƒ¨åˆ†ä¸æœ¬æ•™ç¨‹ä¸­çš„ä»£ç ç›¸åŒã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„ç« èŠ‚ä¸­å›é¡¾å¦‚ä½•ä½¿ç”¨GPUã€‚













